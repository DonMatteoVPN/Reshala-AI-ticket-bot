# ---------------------------------------
# RESHALA SUPPORT - NGINX HOST CONFIG
# ---------------------------------------
# Этот конфиг предназначен для Reverse Proxy на хосте (сервере).
# Он принимает входящие запросы и перенаправляет их в Docker-контейнеры.
#
# Как использовать:
# 1. Скопируйте файл: sudo cp nginx.conf.example /etc/nginx/sites-available/nginx.conf
# 2. Отредактируйте: sudo nano /etc/nginx/sites-available/nginx.conf
#    (Замените your-domain.com на ваш домен)
# 3. Активируйте: sudo ln -s /etc/nginx/sites-available/nginx.conf /etc/nginx/sites-enabled/
# 4. Проверьте: sudo nginx -t
# 5. Перезагрузите: sudo systemctl reload nginx
# 6. Получите SSL: sudo certbot --nginx -d your-domain.com

# ---------------------------------------
# RESHALA MINI APP (Frontend + Backend API)
# ---------------------------------------
server {
    server_name your-domain.com;

    # API запросы → Backend (FastAPI на порту 8001)
    location /api/ {
        proxy_pass http://localhost:8001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Все остальное → Frontend (React SPA на порту 3000)
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
